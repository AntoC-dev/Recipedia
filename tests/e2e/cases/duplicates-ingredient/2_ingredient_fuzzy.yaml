name: "2 - Duplicate Ingredient Fuzzy Detection Flow"
appId: "com.recipedia"
tags:
  - duplicates
---
- runFlow:
    file: "../../flows/setupTest.yaml"
    label: "Setup - Launch app and wait for ready"

- runFlow:
    file: "../../flows/fab/expand.yaml"
    label: "Action - Expand FAB menu"

# FAB ID uses regex pattern because React Native Paper adds suffix on iOS
- tapOn:
    id: "RecipeEdit.*"
    label: "Action - Open manual recipe creation"

- waitForAnimationToEnd

- scrollUntilVisible:
    element:
      id: "RecipeIngredients::AddButton::RoundButton"
    direction: DOWN
    speed: 20
    centerElement: true
    label: "Action - Scroll to ingredients section"

- waitForAnimationToEnd

- tapOn:
    id: "RecipeIngredients::AddButton::RoundButton"
    label: "Action - Add ingredient to recipe"

- tapOn:
    id: "RecipeIngredients::0::NameInput::CustomTextInput"
    label: "Action - Focus on ingredient name input"

- inputText:
    text: "Butte"
    label: "Action - Enter fuzzy ingredient name"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- runFlow:
    when:
      platform: Android
    commands:
      - pressKey: enter

- runFlow:
    when:
      platform: iOS
    commands:
      - tapOn:
          id: "Done"
          label: "Tap Done key to validate the input on iOS"

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- runFlow:
    file: "../../flows/recipe/ingredients/useFuzzyIngredient.yaml"
    env:
      NEW_ITEM_NAME: "Butte"
    label: "Action - Use existing Butter ingredient"

- assertNotVisible:
    text: "Butte"
    label: "Assert - Verify typo ingredient not added"

- assertVisible:
    id: "RecipeIngredients::0::NameInput::CustomTextInput"
    text: "Butter"
    label: "Assert - Verify existing Butter ingredient added"

- tapOn:
    id: "RecipeIngredients::AddButton::RoundButton"
    label: "Action - Add another ingredient to recipe"

- tapOn:
    id: "RecipeIngredients::1::NameInput::CustomTextInput"
    label: "Action - Focus on second ingredient input"

- inputText:
    text: "Butte"
    label: "Action - Enter fuzzy ingredient name again"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- pressKey: "ENTER"

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- runFlow:
    file: "../../flows/recipe/ingredients/confirmAddNewIngredient.yaml"
    label: "Action - Confirm adding fuzzy ingredient as new"

- assertVisible:
    text: "Butte"
    label: "Assert - Verify fuzzy ingredient name appears"

- tapOn:
    id: "Recipe::AppBar::BackButton"
    label: "Cleanup - Exit recipe creation without saving"


- runFlow:
    file: "../../flows/parameters/ingredients/navigateToIngredientsSettings.yaml"
    label: "Cleanup - Navigate to Ingredients Settings"

- runFlow:
    file: "../../flows/parameters/ingredients/deleteIngredientByName.yaml"
    env:
      INGREDIENT_NAME: "Butte"
      INGREDIENT_INDEX: "2"
    label: "Cleanup - Delete Butte ingredient"

- runFlow:
    file: "../../flows/parameters/ingredients/returnToHome.yaml"
    label: "Cleanup - Return to Home screen"
