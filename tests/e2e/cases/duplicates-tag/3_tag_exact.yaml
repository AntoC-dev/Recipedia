name: "3 - Duplicate Tag Exact Prevention Flow"
appId: "com.recipedia"
tags:
  - duplicates
---
- runFlow:
    file: "../../flows/setupTest.yaml"
    label: "Setup - Launch app and wait for ready"

- runFlow:
    file: "../../flows/fab/expand.yaml"
    label: "Action - Expand FAB menu"

# FAB ID uses regex pattern because React Native Paper adds suffix on iOS
- tapOn:
    id: "RecipeEdit.*"
    label: "Action - Open manual recipe creation"

- waitForAnimationToEnd

- scrollUntilVisible:
    element:
      id: "RecipeTags::RoundButton"
    direction: DOWN
    speed: 60
    centerElement: true
    label: "Action - Scroll to tags section"

- waitForAnimationToEnd

- tapOn:
    id: "RecipeTags::RoundButton"
    label: "Action - Add tag to recipe"

- waitForAnimationToEnd

- scrollUntilVisible:
    element:
      id: "RecipeTags::List::0::CustomTextInput"
    direction: DOWN
    speed: 40
    centerElement: true
    label: "Scroll to text input for tag"

- waitForAnimationToEnd

- tapOn:
    id: "RecipeTags::List::0::CustomTextInput"
    label: "Action - Focus on tag input field"

- inputText:
    text: "Dessert"
    label: "Action - Enter existing tag name"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- pressKey: "ENTER"

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- waitForAnimationToEnd

- scrollUntilVisible:
    element:
      id: "RecipeTags::0::Chip"
    direction: DOWN
    speed: 60
    centerElement: true
    label: "Scroll to recipe tags"

- waitForAnimationToEnd

- assertVisible:
    id: "RecipeTags::0::Chip"
    label: "Assert - Verify first tag added to recipe"

- assertVisible:
    text: "Dessert"
    label: "Assert - Verify Dessert tag appears"

- tapOn:
    id: "RecipeTags::RoundButton"
    label: "Action - Add tag to recipe again"

- tapOn:
    id: "RecipeTags::List::1::CustomTextInput"
    label: "Action - Focus on tag input field again"

- inputText:
    text: "Dessert"
    label: "Action - Try to add same tag again"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- pressKey: "ENTER"

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- assertVisible:
    id: "RecipeTags::0::Chip"
    label: "Assert - Verify only one tag chip exists"

- assertNotVisible:
    id: "RecipeTags::1::Chip"
    label: "Assert - Verify duplicate tag was not added"

- assertVisible:
    text: "Dessert"
    label: "Assert - Verify original Dessert tag still present"

- tapOn:
    id: "Recipe::AppBar::BackButton"
    label: "Cleanup - Exit recipe creation without saving"
