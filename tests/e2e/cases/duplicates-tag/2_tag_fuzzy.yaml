name: "2 - Duplicate Tag Fuzzy Detection Flow"
appId: "com.recipedia"
tags:
  - duplicates
---
- runFlow:
    file: "../../flows/setupTest.yaml"
    label: "Setup - Launch app and wait for ready"

- runFlow:
    file: "../../flows/fab/expand.yaml"
    label: "Action - Expand FAB menu"

# FAB ID uses regex pattern because React Native Paper adds suffix on iOS
- tapOn:
    id: "RecipeEdit.*"
    label: "Action - Open manual recipe creation"

- scrollUntilVisible:
    element:
      id: "RecipeTags::RoundButton"
    direction: DOWN
    speed: 60
    centerElement: true
    label: "Action - Scroll to tags section"

- runFlow:
    file: "../../flows/recipe/tags/addTagToRecipeInput.yaml"
    env:
      TAG_NAME: "Dessrt"
      TAG_INDEX: "0"
    label: "Action - Enter fuzzy tag name first attempt"

- runFlow:
    file: "../../flows/recipe/tags/useFuzzyTag.yaml"
    env:
      NEW_ITEM_NAME: "Dessrt"
    label: "Action - Use existing Dessert tag"

- assertNotVisible:
    text: "Dessrt"
    label: "Assert - Verify fuzzy tag not added to recipe"

- scrollUntilVisible:
    element:
      id: "RecipeTags::0::Chip"
    direction: DOWN
    speed: 60
    centerElement: true
    label: "Scroll to recipe tags"

- assertVisible:
    id: "RecipeTags::0::Chip"
    label: "Assert - Verify tag added to recipe"

- assertVisible:
    text: "Dessert"
    label: "Assert - Verify fuzzy tag Dessert added"

- runFlow:
    file: "../../flows/recipe/tags/addTagToRecipeInput.yaml"
    env:
      TAG_NAME: "Dessrt"
      TAG_INDEX: "1"
    label: "Action - Enter fuzzy tag name second attempt"

- runFlow:
    file: "../../flows/recipe/tags/confirmAndEditNewTag.yaml"
    env:
      EDIT_SUFFIX: ""
    label: "Action - Confirm adding fuzzy tag without editing"

- assertVisible:
    id: "RecipeTags::1::Chip"
    label: "Assert - Verify second tag added to recipe"

- assertVisible:
    text: "Dessrt"
    label: "Assert - Verify fuzzy tag name appears"

- tapOn:
    id: "Recipe::AppBar::BackButton"
    label: "Cleanup - Exit recipe creation without saving"


- runFlow:
    file: "../../flows/parameters/tags/navigateToTagsSettings.yaml"
    label: "Cleanup - Navigate to Tags Settings"

- runFlow:
    file: "../../flows/parameters/tags/deleteTagByName.yaml"
    env:
      TAG_NAME: "Dessrt"
      TAG_INDEX: "3"
    label: "Cleanup - Delete Dessrt tag"

- runFlow:
    file: "../../flows/parameters/tags/returnToHome.yaml"
    label: "Cleanup - Return to Home screen"
