name: "2 - Duplicate Recipe Scaled Quantities Detection Flow"
appId: "com.recipedia"
tags:
  - duplicates
---
- runFlow:
    file: "../../flows/setupTest.yaml"
    label: "Setup - Launch app and wait for ready"

- runFlow:
    file: "../../flows/recipe/adding/createBaseRecipeForDuplicateTests.yaml"
    label: "Action - Create base recipe"

- runFlow:
    file: "../../asserts/alerts/en/recipeAddedToDatabase.yaml"
    env:
      RECIPE_NAME: ".*"
    label: "Assert - Verify recipe added to database"

- runFlow:
    file: "../../flows/recipe/verifyRecipeExistsInSearch.yaml"
    env:
      SEARCH_TEXT: "Test Recipe"
    label: "Verify - Confirm recipe is searchable before duplicate test"

- runFlow:
    file: "../../flows/recipe/adding/createRecipeWithScaledQuantities.yaml"
    label: "Action - Create recipe with scaled quantities (2x)"

- runFlow:
    file: "../../asserts/alerts/en/recipeSimilarFound.yaml"
    label: "Assert - Verify scaled duplicate alert appears"

- tapOn:
    id: "Recipe::Dialog::Cancel"
    label: "Action - Cancel adding duplicate recipe"

- waitForAnimationToEnd

- scrollUntilVisible:
    element:
      id: "RecipeIngredients::0::QuantityInput"
    direction: UP
    speed: 40
    centerElement: true
    label: "Action - Scroll up to Pasta quantity input"

- waitForAnimationToEnd

- tapOn:
    id: "RecipeIngredients::0::QuantityInput"
    label: "Action - Focus on Pasta quantity input"

- eraseText:
    label: "Action - Clear Pasta quantity"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- inputText:
    text: "1000"
    label: "Action - Change Pasta to 1000g (far from scaled)"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- pressKey: enter

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- tapOn:
    id: "RecipeIngredients::1::QuantityInput"
    label: "Action - Focus on Tomatoes quantity input"

- eraseText:
    label: "Action - Clear Tomatoes quantity"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- inputText:
    text: "500"
    label: "Action - Change Tomatoes to 500g"

- waitForAnimationToEnd:
    label: "Wait for keyboard animation"

- pressKey: enter

- runFlow:
    file: "../../flows/waitForKeyboardDismiss.yaml"
    label: "Wait for keyboard to dismiss"

- tapOn:
    id: "Recipe::BottomActionButton"
    label: "Action - Validate recipe with far quantities"

- runFlow:
    file: "../../asserts/alerts/en/recipeAddedToDatabase.yaml"
    env:
      RECIPE_NAME: ".*"
    label: "Assert - Verify recipe added successfully (no duplicate)"

- runFlow:
    file: "../../flows/recipe/deleteRecipeBySearch.yaml"
    env:
      SEARCH_TEXT: "Test Recipe"
    label: "Cleanup - Delete first Test Recipe"

- runFlow:
    file: "../../flows/recipe/deleteRecipeBySearch.yaml"
    env:
      SEARCH_TEXT: "Test Recipe"
    label: "Cleanup - Delete second Test Recipe"

- tapOn:
    id: "BottomTabs::Home"
    label: "Cleanup - Return to Home screen"
