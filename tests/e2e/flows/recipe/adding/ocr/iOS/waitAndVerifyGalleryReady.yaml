appId: "com.recipedia"
---
- evalScript: ${output.expectedPhotoCount = (output.modalImageCounter ?? 0) + 1}
- evalScript: ${output.galleryReady = false}
- evalScript: ${output.retryCount = 0}

- runFlow:
    when:
      visible:
        text: "Photo,.*"
    commands:
      - evalScript: ${output.galleryReady = true}
    label: "Check if Photos picker has photos"

- repeat:
    while:
      true: ${!output.galleryReady && output.retryCount < 10}
    commands:
      - evalScript: ${output.retryCount = output.retryCount + 1}

      - swipe:
          direction: DOWN
          duration: 100
          label: "Refresh Photos picker"

      - runFlow:
          when:
            visible:
              text: "Photo,.*"
          commands:
            - evalScript: ${output.galleryReady = true}
          label: "Mark gallery ready if photo found"
    label: "Retry waiting for Photos picker to be ready"
